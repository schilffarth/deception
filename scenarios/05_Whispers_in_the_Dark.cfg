#textdomain wesnoth-deception

# todo use quake when cave walls open
# {REPEAT 5 (
    #!     {QUAKE "rumble.ogg"}
    #! )}

[scenario]
    id=05_Whispers_in_the_Dark
    name= _ "Whispers in the Dark"
    next_scenario=06_Embracing_the_Darkness
    map_data="{~add-ons/deception/maps/05_Whispers_in_the_Dark.map}"
    turns=-1 # unlimited
    victory_when_enemies_defeated=no

	{UNDERGROUND}

    {SCENARIO_MUSIC transience.ogg}
    {EXTRA_SCENARIO_MUSIC underground.ogg}
    {EXTRA_SCENARIO_MUSIC suspense.ogg}
    {EXTRA_SCENARIO_MUSIC into-the-shadows.ogg}
    {EXTRA_SCENARIO_MUSIC nunc_dimittis.ogg}
    {EXTRA_SCENARIO_MUSIC the_deep_path.ogg}

    [story]
        [part]
            #ifhave ~add-ons/deception-ai-art
                background=story/104_mountains_wandering.png
            #else
                # todo non-ai-art background
            #endif
            story= _ "As the mountain peaks jutted from the earth like monstrous teeth, Kalgor and his weary men ventured further into the unforgiving terrain. The journey was treacherous; every step was a gamble against the cruel ice and hidden crevasses. Desperation hung like a shroud over them as they trudged forward, urged on by the relentless pursuit of the human forces. Starved of food, warmth, and hope, each day, a few more orcs succumbed to the cold, their breath freezing in the icy air. Yet, Kalgor pressed on, the burden of leadership a heavy weight upon his shoulders."
        [/part]
        [part]
            #ifhave ~add-ons/deception-ai-art
                background=story/104_mountains.png
            #else
                # todo non-ai-art background
            #endif
            story= _ "In the eerie silence of the night, as the pale moonlight fell upon the snow-blanketed rocks, Kalgor would often sit alone, his gaze lost in the distant peaks. His mind was filled with doubt and fear, yet the fire of determination still burned in his heart. But with each passing day, the fire seemed to flicker and wane, swallowed by the encroaching darkness."
        [/part]
        [part]
            #ifhave ~add-ons/deception-ai-art
                background=story/104_ledge.png
            #else
                # todo non-ai-art background
            #endif
            story= _ "After two days of marching through the relentless mountains, Kalgor spotted a small gap on a mountain's ledge. The gap lead them into a seamless inviting cave."
        [/part]
        [part]
            #ifhave ~add-ons/deception-ai-art
                background=story/104_marching_through_cave.png
            #else
                # todo non-ai-art background
            #endif
            story= _ "Their descent into the cave was almost a relief, a sanctuary from the relentless winds and snow. Yet, the relief was short-lived as they were quickly swallowed by a new enemy - darkness. It wrapped around them, muffling their whispers and transforming the familiar into the unknown. As they moved deeper, the light from their torches barely pierced the oppressive gloom. Shadows danced on the walls, transforming harmless rocks into monstrous shapes. Anxiety gnawed at their hearts, their footsteps echoing eerily in the expansive silence."
        [/part]
        [part]
            #ifhave ~add-ons/deception-ai-art
                background=story/104_evil.png
            #else
                # todo non-ai-art background
            #endif
            story= _ "Yet, it was not the darkness that truly gnawed at Kalgor; it was the whispers. Subtle and insidious, they seemed to emanate from the very walls of the cave. They spoke of power and sacrifice, of surrender and control. They told tales of darkness and the void, promises of strength to protect his people and defeat his enemies. The words echoed in his mind, leaving traces of doubt and fear, sowing seeds of depression and despair."
        [/part]
        [part]
            #ifhave ~add-ons/deception-ai-art
                background=story/104_evil.png
            #else
                # todo non-ai-art background
            #endif
            story= _ "The once strong and determined orc chieftain was now a silhouette against the gloom, a figure of uncertainty and unease. With each passing hour, his demeanor shifted, the light in his eyes fading as the darkness within and without seemed to tighten its grip. Yet, even in the depths of despair, there was a glimmer of hope. A tiny spark, an unyielding resolve that clung to the idea of power, of protection, and of a destiny yet to be fulfilled. It was this spark, flickering in the gloom, that would lead Kalgor further into the heart of darkness."
        [/part]
        {DECEPTION_TRACK {JOURNEY_04_NEW}}
    [/story]

    # Kalgor
    [side]
        side=1
        controller=human
        team_name="Kalgor"
        color="blue"
        save_id=side_kalgor
        shroud=yes
        suppress_end_turn_confirmation=yes
        gold=80 # allow for 4 recalls
    [/side]

    # Voldur
    [side]
        side=2
        controller=null
        team_name="Shadowy Stranger","Monsters"
        user_team_name= _ "Shadowy Stranger"
        color=black

        [leader]
            id=voldur
            type=DEC Arcane Master
            gender=male
            name="Voldur"
            unrenamable=yes
            # Coordinates are defined in map
        [/leader]

        # Skeleton, guarding the Ring of Darkness
        #ifdef EASY
            [unit]
                id=skeleton
                type=Skeleton
                x=27
                y=30
            [/unit]
        #endif
        #ifdef NORMAL
            [unit]
                id=skeleton
                type=Revenant
                x=27
                y=30
            [/unit]
            [unit]
                id=skeleton2
                type=Revenant
                x=28
                y=30
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                id=skeleton
                type=Draug
                x=27
                y=30
            [/unit]
            [unit]
                id=skeleton2
                type=Revenant
                x=28
                y=30
            [/unit]
        #endif
    [/side]

    # Monsters
    [side]
        side=3
        controller=ai
        team_name="Monsters"
        color="brown"

        {AI_AGGRESSIVE}

        # Bats
        [unit]
            type=Vampire Bat
            x=37
            y=33
        [/unit]
        [unit]
            type=Vampire Bat
            x=37
            y=33
        [/unit]
        [unit]
            type=Vampire Bat
            x=37
            y=33
        [/unit]
        [unit]
            type=Blood Bat
            x=37
            y=33
        [/unit]
        #ifdef HARD
            [unit]
                type=Blood Bat
                x=37
                y=33
            [/unit]
            [unit]
                type=Dread Bat
                x=37
                y=33
            [/unit]
        #endif

        # Spider
        [unit]
            type=Giant Spider
            x=48
            y=4
        [/unit]
        #ifdef HARD
            [unit]
                type=Giant Spider
                x=48
                y=4
            [/unit]
        #endif

        # Ants
        [unit]
            type=Fire Ant
            x=18
            y=34
        [/unit]
        [unit]
            type=Fire Ant
            x=18
            y=34
        [/unit]
        [unit]
            type=Giant Ant
            x=18
            y=34
        [/unit]
        [unit]
            type=Giant Ant
            x=18
            y=34
        [/unit]
        [unit]
            type=Giant Ant
            x=18
            y=34
        [/unit]
        #ifndef EASY
            [unit]
                type=Fire Ant
                x=18
                y=34
            [/unit]
            [unit]
                type=Fire Ant
                x=18
                y=34
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                type=Fire Ant
                x=18
                y=34
            [/unit]
            [unit]
                type=Fire Ant
                x=18
                y=34
            [/unit]
            [unit]
                type=Fire Ant
                x=18
                y=34
            [/unit]
        #endif

        # Unit hidden in the room with the Blade of Dread
        #ifdef HARD
            [unit]
                type=Wraith
                x=39
                y=7
            [/unit]
        #else
            [unit]
                type=Ghost
                x=39
                y=7
            [/unit]
        #endif

        # Unit hidden in the room with the Bonestack
        [unit]
            type=Skeleton
            x=33
            y=3
        [/unit]
        #ifndef EASY
            [unit]
                type=Revenant
                x=33
                y=3
            [/unit]
            [unit]
                type=Skeleton Archer
                x=33
                y=3
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                type=Bone Shooter
                x=33
                y=3
            [/unit]
            [unit]
                type=Revenant
                x=33
                y=3
            [/unit]
        #endif

        # Unit hidden in the big south-western room, with the final rune
        [unit]
            type=Walking Corpse
            x=7
            y=29
        [/unit]
        [unit]
            type=Walking Corpse
            x=7
            y=29
        [/unit]
        [unit]
            type=Walking Corpse
            x=7
            y=29
        [/unit]
        #ifndef EASY
            [unit]
                type=Soulless
                x=7
                y=29
            [/unit]
            [unit]
                type=Soulless
                x=7
                y=29
            [/unit]
            [unit]
                type=Soulless
                x=7
                y=29
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                type=Soulless
                x=7
                y=29
            [/unit]
            [unit]
                type=Soulless
                x=7
                y=29
            [/unit]
            [unit]
                type=Walking Corpse
                x=7
                y=29
            [/unit]
            [unit]
                type=Walking Corpse
                x=7
                y=29
            [/unit]
        #endif

        # Unit hidden in the small south-western room
        #ifdef EASY
            [unit]
                type=Ghoul
                x=6
                y=20
            [/unit]
        #endif
        #ifdef NORMAL
            [unit]
                type=Ghoul
                x=6
                y=20
            [/unit]
            [unit]
                type=Necrophage
                x=6
                y=22
            [/unit]
            [unit]
                type=Necrophage
                x=13
                y=18
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                type=Ghast
                x=6
                y=20
            [/unit]
            [unit]
                type=Necrophage
                x=6
                y=22
            [/unit]
            [unit]
                type=Necrophage
                x=13
                y=18
            [/unit]
            [unit]
                type=Necrophage
                x=13
                y=18
            [/unit]
        #endif
    [/side]

    #define OPEN_CAVE
        [if]
            [variable]
                name=events_triggered
                equals=8 # 5 runes + 3 items
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "A pulsating energy vibrates through Kalgor, seeming to resonate with the other energies of darkness. The resonation began to reach a crescendo, echoing within the vast cavern."
                [/message]
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "Suddenly, the deafening silence was interrupted by a loud, ominous rumble that echoed throughout the labyrinthine cave."
                [/message]
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "Kalgor's eyes were imbued with an eerie glow from the dark artifacts. He sensed a profound change, like the cave was bending to his will or perhaps, he was bending it to the will of the cave."
                [/message]
                [message]
                    speaker=kalgor
                    message= _ "The cave...it's...it's alive..."
                [/message]
                [message]
                    speaker=kalgor
                    message= _ "No, it is not the cave. It is a presence..."
                [/message]
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "And as if in response to Kalgor's words, a series of tremors shook the cave. The rumbling seemed to intensify, culminating in a thunderous crash as a wall in the center of the cave crumbled, revealing a new path."
                [/message]
                [terrain]
                    terrain=Uu
                    x=22-22
                    y=10-13
                [/terrain]
                [remove_shroud]
                    x=21-23
                    y=10-14
                [/remove_shroud]
                [scroll_to]
                    x=23
                    y=12
                [/scroll_to]
                [delay]
                    time=500
                [/delay]
            [/then]
            [else]
                {VARIABLE_OP events_triggered add 1}
            [/else]
        [/if]
    #enddef

    {ABILITIES_EVENTS}
    {WEAPON_SPECIALS_EVENTS}

    [event]
        name=prestart

        {PLACE_UNIT_KALGOR 3 45 35}

        # Boots
        {VARIABLE boots_picked_1 no}
        {VARIABLE boots_picked_2 no}

        # Count the events of darkness, to unlock the final path towards Voldur
        {VARIABLE events_triggered 1}

        # Boots to grant +3 movement, player needs to decide for 2 / 4 units to pick them
        [item]
            x=48
            y=34
            image="items/chest-plain-closed.png"
        [/item]
        [item]
            x=48
            y=35
            image="items/chest-plain-closed.png"
        [/item]

        # Carvings on the wall of the cave entrance
        [item]
            x=47
            y=32
            image="items/burial.png"
        [/item]
        [item]
            x=44
            y=30
            image="items/orcish-flag.png"
        [/item]

        # Spider eggs, destroyed upon moving onto them, but another spider spawns
        [item]
            x=44
            y=11
            image="scenery/nest-full.png"
        [/item]
        [item]
            x=44
            y=12
            image="scenery/nest-full.png"
        [/item]

        # Ring of Darkness, guarded by a skeleton
        [item]
            x=27
            y=31
            image="items/ring-red.png"
        [/item]

        # Blade of Dread, locked behind runes #1 and #2
        # As the Blade of Dread is picked up, a Wraith appears
        [item]
            x=38
            y=8
            image="items/sword-wraith.png"
        [/item]
        [item]
            x=47
            y=7
            image="scenery/rune1.png"
        [/item]
        [item]
            x=37
            y=31
            image="scenery/rune2.png"
        [/item]

        # Bonestack, revealing whispering noises, locked behind rune #3
        # The noises tempt Kalgor to fall for the mysterious darkness
        [item]
            x=35
            y=3
            image="items/bonestack.png"
        [/item]
        [item]
            x=11
            y=34
            image="scenery/rune3.png"
        [/item]

        # Large south-western cave hall unlocks through the fourth rune
        [item]
            x=41
            y=3
            image="scenery/rune4.png"
        [/item]

        # Small room, next to Voldur's hall, opens with the fifth rune
        [item]
            x=5
            y=30
            image="scenery/rune5.png"
        [/item]

        # Irrelevant decorative scenery
        [item]
            x=25
            y=32
            image="items/bones.png"
        [/item]
        [item]
            x=16
            y=9
            image="items/bones.png"
        [/item]
        [item]
            x=15
            y=5
            image="items/bones.png"
        [/item]
        [item]
            x=4
            y=4
            image="items/bones.png"
        [/item]
        [item]
            x=7
            y=5
            image="items/bonestack.png"
        [/item]
        [item]
            x=6
            y=6
            image="items/bonestack.png"
        [/item]
        [item]
            x=10
            y=8
            image="items/bonestack.png"
        [/item]
        [item]
            x=6
            y=12
            image="items/altar-evil.png"
        [/item]
    [/event]

    [event]
        name=last_breath
        [filter]
            id=kalgor
        [/filter]
        [message]
            speaker=kalgor
            message= _ "Darkness... everywhere..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=start

        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Kalgor and his surviving men stand at the mouth of the cave. An eerie silence envelops them, their uncertain whispers swallowed by the vast, black void."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Kalgor may recruit or recall units in the start only. In the second turn, the castle will disappear."
        [/message]
    [/event]

    [objectives]
        {OBJECTIVE_WIN "Explore the caves."}
        {OBJECTIVE_LOSE "Death of Kalgor."}
        {OBJECTIVE_NOTE "Kalgor may recruit or recall units in the start only."}
        {OBJECTIVE_NOTE "In the second turn, the castle will disappear."}
        {OBJECTIVE_NOTE "The cave might have secret items for Kalgor's benefit."}
    [/objectives]

    # At turn 2, remove the castle. The player can recruit / recall a total of 4 units for this scenario.
    [event]
        name=turn 2

        [terrain]
            terrain=Ur
            x=44-45
            y=34-36
        [/terrain]
    [/event]

    # Boots 1
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=48
            y=34
        [/filter]
        [if]
            [variable]
                name=boots_picked_1
                equals=no
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "These boots grant +3 max moves for the unit wearing them."
                    [option]
                        message= _ "Equip them."
                        [command]
                            [message]
                                speaker=narrator
                                image="wesnoth-icon.png"
                                message= _ "The unit is granted +3 max moves for the rest of the scenario."
                            [/message]
                            [modify_unit]
                                [filter]
                                    x=$x1
                                    y=$y1
                                [/filter]
                                [object]
                                    id=temporary_movement_buff
                                    name= _ "Speedy Boots"
                                    description= _ "This unit's movement has been increased by 3."
                                    duration=scenario
                                    silent=yes
                                    [effect]
                                        apply_to=movement
                                        increase=3
                                    [/effect]
                                [/object]
                            [/modify_unit]

                            {VARIABLE boots_picked_1 yes}

                            [remove_item]
                                x=$x1
                                y=$y1
                            [/remove_item]
                            [item]
                                x=$x1
                                y=$y1
                                image="items/chest-plain-open.png"
                            [/item]
                        [/command]
                    [/option]
                    [option]
                        message= _ "Leave them for someone else."
                    [/option]
                [/message]
            [/then]
        [/if]
    [/event]

    # Boots 2
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            x=48
            y=35
        [/filter]
        [if]
            [variable]
                name=boots_picked_2
                equals=no
            [/variable]
            [then]
                [message]
                    speaker=narrator
                    image="wesnoth-icon.png"
                    message= _ "These boots grant +3 max moves for the unit wearing them."
                    [option]
                        message= _ "Equip them."
                        [command]
                            [message]
                                speaker=narrator
                                image="wesnoth-icon.png"
                                message= _ "The unit is granted +3 max moves for the rest of the scenario."
                            [/message]
                            [modify_unit]
                                [filter]
                                    x=$x1
                                    y=$y1
                                [/filter]
                                [object]
                                    id=temporary_movement_buff
                                    name= _ "Speedy Boots"
                                    description= _ "This unit's movement has been increased by 3."
                                    duration=scenario
                                    silent=yes
                                    [effect]
                                        apply_to=movement
                                        increase=3
                                    [/effect]
                                [/object]
                            [/modify_unit]

                            {VARIABLE boots_picked_2 yes}

                            [remove_item]
                                x=$x1
                                y=$y1
                            [/remove_item]
                            [item]
                                x=$x1
                                y=$y1
                                image="items/chest-plain-open.png"
                            [/item]
                        [/command]
                    [/option]
                    [option]
                        message= _ "Leave them for someone else."
                    [/option]
                [/message]
            [/then]
        [/if]
    [/event]

    # Carvings on the wall
    [event]
        name=moveto
        [filter]
            side=1
            x=44,47
            y=30,32
        [/filter]
        [message]
            speaker=unit
            message= _ "There's carvings on these walls..."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A warning sign, speaking of a forbidden, haunted path. The unsettling implication hangs heavy in the air, a challenge to Kalgor's courage."
        [/message]
    [/event]

    # Bats
    [event]
        name=sighted
        [filter]
            race=bats
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A sudden wave of screeching fills the cave. The orcs brace themselves as bats descend in a chaotic flurry, their silhouettes flashing in the dim torchlight."
        [/message]
    [/event]

    # Spider
    [event]
        name=sighted
        [filter]
            type=Giant Spider
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Without warning, a monstrous figure leaps from the dark recesses of the cave."
        [/message]

        # Ants
        [event]
            name=sighted
            [filter]
                type=Fire Ant
                [or]
                    type=Giant Ant
                [/or]
            [/filter]
            [filter_second]
                side=1
            [/filter_second]
            [message]
                speaker=second_unit
                message= _ "By the gods... I've never seen ants of such monstrous size in my life!"
            [/message]
        [/event]
    [/event]

    # Skeleton
    [event]
        name=sighted
        [filter]
            id=skeleton
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "As Kalgor and his dwindling band of orcs push deeper into the cave's gloom, a sudden chilling wind sweeps through the narrow passage. Their whispers fade as the darkness coalesces into a deeper silence. The cold smell of damp stone and ancient dust hangs heavy in the air."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A skeleton warrior, standing in grim defiance, its hollow eyes gleaming in the torchlight. Clad in decayed armor, it clutches a rusted sword, an otherworldly aura hanging around it."
        [/message]
        [message]
            speaker=second_unit
            message= _ "Dark spirits... we've walked into a cursed place."
        [/message]
        [message]
            speaker=kalgor
            message= _ "Face it we must... for life clings tighter than death."
        [/message]

        {MODIFY_UNIT id=skeleton side 3}
        {MODIFY_UNIT id=skeleton2 side 3}
    [/event]

    # Kalgor moves onto the Ring of Darkness
    [event]
        name=moveto
        [filter]
            id=kalgor
            x=27
            y=31
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Kalgor's eyes are drawn to a red band gleaming eerily amidst the debris. As he places the ring on his finger, a chilling rush permeates his being, as if tendrils of shadow were coiling around his heart."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Kalgor feels his senses sharpen, yet a cloud seems to descend upon his thoughts, causing his decision-making to skew towards aggression and ruthlessness. His heart thrums with an unknown power, yet also a bleak melancholy, as if the ring has infused him with a piece of the infinite void itself."
        [/message]
        [remove_item]
            x=27
            y=31
        [/remove_item]
        {KALGOR_ADD_RING_OF_DARKNESS}
        {OPEN_CAVE}
    [/event]

    # Kalgor moves onto the Blade of Dread
    [event]
        name=moveto
        [filter]
            id=kalgor
            x=38
            y=8
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A blade, enshrouded in an aura of desolation, lays tempting on the ground. As Kalgor wraps his fingers around the hilt, a sharp, bitter cold races up his arm, as though frost was creeping under his skin. His consciousness sinks deeper into an ocean of darkness, the whispering voices of despair echoing louder in his mind."
        [/message]
        [remove_item]
            x=38
            y=8
        [/remove_item]
        {KALGOR_ADD_BLADE_OF_DREAD}
        [unit]
            side=3
            type=Spectre
            x=38
            y=8
        [/unit]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A spectral figure materializes from the gloom. Its hollow, haunting gaze sends shivers down Kalgor's spine."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "With a shaky breath, Kalgor steps back, gripping the blade tighter, his heart hammering against his chest, he stares into the void-like eyes of the Wraith."
        [/message]
        [message]
            speaker=kalgor
            message= _ "<i>(whispering)</i> W-w... Why are you here? What do you want from me?"
        [/message]
        [event]
            name=attack
            [filter]
                id=kalgor
            [/filter]
            [message]
                speaker=narrator
                image="wesnoth-icon.png"
                message= _ "Each swing of the blade, while demonstrating increased strength and precision, also chips away at Kalgor's spirit, causing him to grow further despondent and susceptible to manipulation."
            [/message]
        [/event]

        [terrain]
            terrain=Uu
            x=31,32
            y=14,14
        [/terrain]
        [remove_shroud]
            x=30-34
            y=13-15
        [/remove_shroud]
        {OPEN_CAVE}
    [/event]

    # Kalgor moves onto the Bonestack
    [event]
        name=moveto
        [filter]
            x=35
            y=3
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The stack of bones pulses with a sickly green aura. As reaching out to touch it, the cold touch of death washes over Kalgor. It's as if every ounce of happiness, every trace of hope, is being sucked out, leaving only a chilling emptiness in its wake. A sinister whisper brushes past his consciousness, stirring up his darkest fears and fanning his thirst for power."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "It’s an eerie feeling, like an unseen hand tugging at the strings of his soul, drawing him deeper into the abyss of darkness, shaping him into a perfect puppet for unseen machinations."
        [/message]
        [remove_item]
            x=35
            y=3
        [/remove_item]
        {OPEN_CAVE}
    [/event]

    # The spider's eggs are destroyed
    [event]
        name=moveto
        [filter]
            side=1
            x=44,44
            y=11,12
        [/filter]
        [message]
            speaker=unit
            message= _ "This must be the monster's eggs."
        [/message]
        [message]
            speaker=kalgor
            message= _ "Take care of them, before it's too late."
        [/message]
        [remove_item]
            x=44,44
            y=11,12
        [/remove_item]
        [item]
            x=44
            y=11
            image="scenery/nest-empty.png"
        [/item]
        [item]
            x=44
            y=12
            image="scenery/nest-empty.png"
        [/item]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "As the monstrous spider's first nest is crushed, the eggs nearby start moving and cracking, revealing an ignominious spectacle of a slimy abomination coming to life."
        [/message]
        [unit]
            type=Giant Spider
            side=3
            x=45
            y=12
        [/unit]
    [/event]

    # First rune opens the bat cave's wall from the bridge
    [event]
        name=moveto
        [filter]
            side=1
            x=47
            y=7
        [/filter]
        [remove_item]
            x=47
            y=7
        [/remove_item]
        [item]
            x=47
            y=7
            image="scenery/rune1-glow.png"
        [/item]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "As the rune flickers to life, casting strange shadows upon the cave walls, an unseen wind stirs, and a distant echo resonates through the cave."
        [/message]
        [message]
            speaker=kalgor
            message= _ "The cave responds. It reveals itself, bit by bit. Let's proceed with caution."
        [/message]
        [terrain]
            terrain=Uu
            x=37-38
            y=28-28
        [/terrain]
        [remove_shroud]
            x=36-40
            y=26-29
        [/remove_shroud]
        [scroll_to]
            x=38
            y=27
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        {OPEN_CAVE}

        # More bats spawn

        # Bats
        [unit]
            type=Vampire Bat
            side=3
            x=37
            y=33
        [/unit]
        [unit]
            type=Vampire Bat
            side=3
            x=37
            y=33
        [/unit]
        [unit]
            type=Blood Bat
            side=3
            x=37
            y=33
        [/unit]
        #ifdef NORMAL
            [unit]
                type=Blood Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Blood Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Dread Bat
                side=3
                x=37
                y=33
            [/unit]
        #endif
        #ifdef HARD
            [unit]
                type=Blood Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Blood Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Blood Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Dread Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Dread Bat
                side=3
                x=37
                y=33
            [/unit]
            [unit]
                type=Dread Bat
                side=3
                x=37
                y=33
            [/unit]
        #endif
    [/event]

    # Second rune opens the northern cave hall with the Blade of Dread
    [event]
        name=moveto
        [filter]
            side=1
            x=37
            y=31
        [/filter]
        [remove_item]
            x=37
            y=31
        [/remove_item]
        [item]
            x=37
            y=31
            image="scenery/rune2-glow.png"
        [/item]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The rune hums with an ancient energy as it activates. Soft whispers fill the air, and a pathway once hidden now begins to shimmer."
        [/message]
        [message]
            speaker=kalgor
            message= _ "The cave whispers secrets. It calls us further in."
        [/message]
        [terrain]
            terrain=Uu
            x=36,37
            y=15,15
        [/terrain]
        [remove_shroud]
            x=34-38
            y=14-16
        [/remove_shroud]
        [scroll_to]
            x=37
            y=15
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        {OPEN_CAVE}
    [/event]

    # Third rune opens the second northern cave hall with the Bonestack
    [event]
        name=moveto
        [filter]
            side=1
            x=11
            y=34
        [/filter]
        [remove_item]
            x=11
            y=34
        [/remove_item]
        [item]
            x=11
            y=34
            image="scenery/rune3-glow.png"
        [/item]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The rune glows brightly, and a low rumble reverberates through the stone. The cave's air seems to grow denser as if it is alive and breathing."
        [/message]
        [message]
            speaker=kalgor
            message= _ "It feels as though we tread upon the heartbeat of the earth. The cave is aware, and it guides us."
        [/message]
        [terrain]
            terrain=Uu
            x=27-28
            y=11-11
        [/terrain]
        [remove_shroud]
            x=26-29
            y=9-12
        [/remove_shroud]
        [scroll_to]
            x=27
            y=11
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        {OPEN_CAVE}
    [/event]

    # Fourth rune opens the south-western large cave hall
    [event]
        name=moveto
        [filter]
            side=1
            x=41
            y=3
        [/filter]
        [remove_item]
            x=41
            y=3
        [/remove_item]
        [item]
            x=41
            y=3
            image="scenery/rune4-glow.png"
        [/item]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The cave's ambient noise takes on an eerie tone. The walls seem to pulse, resonating with the growing energy of the runes."
        [/message]
        [message]
            speaker=kalgor
            message= _ "We're near. I can sense the cave shifting, responding to our movements, our decisions."
        [/message]
        [terrain]
            terrain=Uu
            x=20-22
            y=18-18
        [/terrain]
        [remove_shroud]
            x=19-23
            y=18-20
        [/remove_shroud]
        [scroll_to]
            x=21
            y=19
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        {OPEN_CAVE}
    [/event]

    # Fifth rune opens the small room, next to Voldur's hall
    [event]
        name=moveto
        [filter]
            side=1
            x=5
            y=30
        [/filter]
        [remove_item]
            x=5
            y=30
        [/remove_item]
        [item]
            x=5
            y=30
            image="scenery/rune5-glow.png"
        [/item]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "As the rune ignites, the cave lurches slightly. A soft glow illuminates a part of the cave previously enshrouded in darkness, revealing yet another hidden passage."
        [/message]
        [message]
            speaker=kalgor
            message= _ "The cave unveils its secrets one after another."
        [/message]
        [terrain]
            terrain=Uu
            x=10-11
            y=22-22
        [/terrain]
        [terrain]
            terrain=Uu
            x=15-19
            y=18-18
        [/terrain]
        [remove_shroud]
            x=9-12
            y=21-23
        [/remove_shroud]
        [scroll_to]
            x=11
            y=22
        [/scroll_to]
        [delay]
            time=500
        [/delay]
        {OPEN_CAVE}
    [/event]

    [event]
        name=turn 5
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A chill runs down their spines as faint whispers echo in the cavernous labyrinth. The cave seems to breathe, harboring a secret it dares them to uncover."
        [/message]
    [/event]

    [event]
        name=turn 10
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "With each step they take into the cave, the biting chill of the air grows. It is an ominous sign, one that grips their hearts with icy dread."
        [/message]
    [/event]

    [event]
        name=turn 15
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Apparitions flicker on the cave walls, an eerie dance of shadow and light. The spectral whispers grow louder, casting a web of fear and paranoia."
        [/message]
    [/event]

    [event]
        name=turn 20
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "As they progress deeper into the cave, a chilling echo resonates around them. Their every footfall is reflected in a myriad of ghostly whispers, each carrying an ominous prophecy of the unknown."
        [/message]
    [/event]

    [event]
        name=turn 25
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The ground shakes beneath them. The trembling cave warns of potential doom, a grim reminder of the mountain’s volatile temper."
        [/message]
    [/event]

    [event]
        name=turn 30
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Kalgor shakes off the terror, his determination burning brighter."
        [/message]
        [message]
            speaker=kalgor
            message= _ "<i>muttering, gripping his weapon tighter</i> We cannot afford to falter..."
        [/message]
    [/event]

    [event]
        name=turn 35
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A strange glow emanates from further within the cave. Uncertainty and fear mingle, fueling their dread of the unknown."
        [/message]
    [/event]

    [event]
        name=sighted
        [filter]
            id=voldur
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "A sense of dread and apprehension clings to Kalgor like a second skin. The room is enormous, its ceilings lost in shadow, stalactites hanging down like the fangs of some primordial beast. Torches flicker in sconces along the walls, casting an eerie, otherworldly light upon the space."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "At the far end of the chamber, against an enormous throne of stone and bone, sits a figure draped in a cloak of inky darkness. As Kalgor draws closer, the figure stands to reveal himself. His face is shadowed by the hood of his cloak, but the glint in his eyes is almost familiar, like a friend who has been waiting for him in the darkness."
        [/message]
        [message]
            speaker=voldur
            caption= _ "Stranger"
            message= _ "Ah, Kalgor, my friend."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The voice echoes, filling the cavern with a soothing resonance that seems to quell the unrest within Kalgor's soul. It's a balm, a salve to the wounds of fear and uncertainty that he'd been nurturing within himself."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Hesitant, Kalgor moves forward, drawn by the strange allure of this enigmatic figure."
        [/message]
        [message]
            speaker=voldur
            caption= _ "Stranger"
            message= _ "You've traveled far and fought hard to reach here. Come, sit by my side."
        [/message]

        {MOVE_UNIT id=kalgor 10 6}

        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Each step echoes within the cavern and within his mind, an undercurrent of anxiety and anticipation mixing with a growing sense of relief."
        [/message]
        [message]
            speaker=kalgor
            message= _ "Who are you? Why am I here?"
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The stranger's gestures seem oddly inviting, strangely comforting, an anchorage in a sea of uncertainty."
        [/message]
        [message]
            speaker=voldur
            message= _ "I am Voldur, a humble master of the arcane, and you, Kalgor, are here because destiny has led you to me."
        [/message]
        [message]
            speaker=kalgor
            message= _ "I... I seek power. Power... to protect my people... Power to vanquish my enemies."
        [/message]
        [message]
            speaker=voldur
            message= _ "A noble pursuit."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Voldur's voice is laced with sympathy. The tone is disarming, drawing out Kalgor's anxiety, layer by layer, and replacing it with a sense of hopeful anticipation."
        [/message]
        [message]
            speaker=voldur
            message= _ "And I can help you achieve it, Kalgor."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "With a sense of hope igniting within him, a spark within the all-consuming darkness, Kalgor nods."
        [/message]
        [message]
            speaker=kalgor
            message= _ "Teach me, Voldur. I am willing to embrace the darkness if it saves myself... and my people."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Kalgor's declaration rings out, echoing in the cavern, and within him, a sense of both foreboding and exhilaration twines around his heart."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "Voldur smiles in the flickering light, a promise and a threat intertwined."
        [/message]
        [message]
            speaker=voldur
            message= _ "Then let us begin, Kalgor. Together, we will shape the destiny of our lands."
        [/message]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "As the words echo within the cavern, a shroud of darkness seems to descend on Kalgor, a cloak of power, fear, and hope."
        [/message]

        {CLEAR_VARIABLE boots_picked_1}
        {CLEAR_VARIABLE boots_picked_2}
        {CLEAR_VARIABLE events_triggered}

        [endlevel]
            result=victory
            bonus=0
            carryover_percentage=0
        [/endlevel]
    [/event]
[/scenario]
